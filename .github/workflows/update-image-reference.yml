name: Update image reference

on:
  workflow_call:
    inputs:
      project:
        required: true
        type: string
      application:
        required: true
        type: string
      namespace:
        required: true
        type: string
      image:
        required: true
        type: string
      repository:
        required: false
        type: string
        default: cern-sis/kubernetes
      ref_type:
        required: true
        type: string
      new_ref:
        required: true
        type: string
    secrets:
      PAT:
        required: true
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: peter-evans/repository-dispatch@v1
      with:
        repository: ${{ inputs.repository }}
        event-type: deploy
        token: ${{ secrets.PAT }}
        client-payload: '{"project":"${{ inputs.project }}","application":"${{ inputs.application }}","namespace":"${{ inputs.namespace }}","image":"${{ inputs.image }}","ref_type":"${{ inputs.ref_type}}","new_ref":"${{ inputs.new_ref }}"}'
